new EventLoopAnimation(document.querySelector('.event-loop-walkthrough'))
    .state().moveToLine(1).pushTask(true).pushStack('script').showCodeBar()
    .state().pushLog()
    .state().moveToLine(3)
    .state().commentary("setTimeout callbacks are queued as tasks")
    .state().hideCommentary().pushTask()
    .state().moveToLine(7)
    .state().commentary("Promise callbacks are queued as microtasks")
    .state().hideCommentary().pushMicrotask()
    .state().moveToLine(13)
    .state().pushLog()
    .state().hideCodeBar().popStack()
    .state().commentary("At the end of a task, we process microtasks")
    .state().hideCommentary().activateMicrotask()
    .state().showCodeBar().moveToLine(8).pushStack('Promise callback')
    .state().pushLog()
    .state().hideCodeBar().commentary("This promise callback returns 'undefined', which queues the next promise callback as a microtask")
    .state().hideCommentary().pushMicrotask()
    .state().popStack().commentary("This microtask is done so we move onto the next one in the queue")
    .state().hideCommentary()
    .state().shiftMicrotask().activateMicrotask()
    .state().showCodeBar().moveToLine(10).pushStack('Promise callback')
    .state().pushLog()
    .state().hideCodeBar().popStack().shiftMicrotask()
    .state().commentary("And that's this task done! The browser may update rendering")
    .state().hideCommentary()
    .state().shiftTask().activateTask()
    .state().showCodeBar().moveToLine(4).pushStack('setTimeout callback')
    .state().pushLog()
    .state().hideCodeBar().popStack()
    .state().shiftTask()
    .state().commentary('fin')
;